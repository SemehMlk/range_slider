package com.cacib.t2s.kemm.api.mappers;

import com.cacib.t2s.kemm.domain.jpa.preferences.UserPreference;
import com.cacib.t2s.kemm.model.UserPreferenceDto;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mapstruct.factory.Mappers;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.MockitoAnnotations;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.*;

class UserPreferenceMapperTest {

    @Mock
    private JsonObjectMapper jsonObjectMapper;

    private UserPreferenceMapper userPreferenceMapper;

    @BeforeEach
    void setUp() {
        MockitoAnnotations.openMocks(this);
        // Utilise l'implémentation générée de MapStruct
        userPreferenceMapper = Mappers.getMapper(UserPreferenceMapper.class);
    }

    @Test
    void testToEntitySuccess() {
        // Arrange
        UserPreferenceDto dto = new UserPreferenceDto();
        dto.setConfig("{\"key\":\"value\"}");
        UserPreference expectedEntity = new UserPreference();

        when(jsonObjectMapper.jsonToObject(dto.getConfig())).thenReturn(new Object());

        // Act
        UserPreference result = userPreferenceMapper.toEntity(dto);

        // Assert
        assertNotNull(result);
        assertEquals(dto.getConfig(), result.getConfig());
        verify(jsonObjectMapper, times(1)).jsonToObject(dto.getConfig());
    }

}
