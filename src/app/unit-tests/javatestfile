export function AutoUnsubscribe() {
  return function (constructor: Function) {
    const originalNgOnDestroy = constructor.prototype.ngOnDestroy;

    constructor.prototype.ngOnDestroy = function () {
      if (this.__subscriptions) {
        this.__subscriptions.forEach((sub: Subscription) => sub.unsubscribe());
      }

      if (originalNgOnDestroy && typeof originalNgOnDestroy === 'function') {
        originalNgOnDestroy.apply(this, arguments);
      }
    };

    const originalSubscribe = constructor.prototype.subscribe;

    constructor.prototype.subscribe = function(...args) {
      if (!this.__subscriptions) {
        this.__subscriptions = [];
      }

      const subscription = originalSubscribe.apply(this, args);
      this.__subscriptions.push(subscription);

      return subscription;
    };
  };
}
