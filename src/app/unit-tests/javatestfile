public static Specification<KemmCanonicalMessage> buildSpecification(ApiSearchRequestDto request) {
    try {
        Specification<KemmCanonicalMessage> spec = Specification.where(null);

        if (request != null && request.getLogicOperator() != null) {
            for (ApiSearchCriteriaDto criteria : request.getCriteria()) {
                Specification<KemmCanonicalMessage> criteriaSpec = createSpecification(criteria);
                if (criteria.getSubCriteria() != null && !criteria.getSubCriteria().isEmpty()) {
                    Specification<KemmCanonicalMessage> subSpec = Specification.where(null);
                    for (ApiSearchCriteriaDto subCriteria : criteria.getSubCriteria()) {
                        Specification<KemmCanonicalMessage> subCriteriaSpec = createSpecification(subCriteria);
                        if ("AND".equalsIgnoreCase(criteria.getGroupOperator())) {
                            subSpec = subSpec.and(subCriteriaSpec);
                        } else if ("OR".equalsIgnoreCase(criteria.getGroupOperator())) {
                            subSpec = subSpec.or(subCriteriaSpec);
                        }
                    }
                    criteriaSpec = subSpec;
                }

                if ("AND".equalsIgnoreCase(request.getLogicOperator())) {
                    spec = spec.and(criteriaSpec);
                } else if ("OR".equalsIgnoreCase(request.getLogicOperator())) {
                    spec = spec.or(criteriaSpec);
                }
            }
        }
        return spec;

    } catch (Exception e) {
        throw new InvalidRequestException(ApiErrorCodes.INVALID_SEARCH_REQUEST, List.of(e.getMessage()), HttpStatus.BAD_REQUEST);
    }
}
