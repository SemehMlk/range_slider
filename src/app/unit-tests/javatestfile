import com.fasterxml.jackson.databind.ObjectMapper;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class TemplateParser {

    public static String extractJson(String text, String startDelimiter, String endDelimiter) {
        String regex = Pattern.quote(startDelimiter) + "(.*?)" + Pattern.quote(endDelimiter);
        Pattern pattern = Pattern.compile(regex, Pattern.DOTALL);
        Matcher matcher = pattern.matcher(text);

        if (matcher.find()) {
            return matcher.group(1).trim();
        }
        return null;
    }

    public static void main(String[] args) {
        String template = """
                ARCHIVE_BEGIN
                PAYLOAD_INFO_BEGIN
                { "info": "some data" }
                PAYLOAD_INFO_END
                PAYLOAD_BEGIN
                { "key1": "value1", "key2": "value2" }
                PAYLOAD_END
                ARCHIVE_END
                """;

        // Extraction du JSON dans PAYLOAD
        String myJson = extractJson(template, "PAYLOAD_BEGIN", "PAYLOAD_END");

        if (myJson != null) {
            System.out.println("JSON extrait : " + myJson);

            // Désérialisation en objet TnsSchema
            ObjectMapper objectMapper = new ObjectMapper();
            try {
                TnsSchema myObject = objectMapper.readValue(myJson, TnsSchema.class);
                System.out.println("Objet TnsSchema : " + myObject);
            } catch (Exception e) {
                e.printStackTrace();
            }
        } else {
            System.out.println("Aucun JSON trouvé entre PAYLOAD_BEGIN et PAYLOAD_END.");
        }
    }
}
